<mat-grid-list cols="5" rowHeight="25vh">
  <mat-grid-tile colspan="1" rowspan="2">
    <mat-card class="container">
      <mat-card-title>Filters</mat-card-title>
      <section [formGroup]="filters">
        <div *ngFor="let box of checkboxes">
          <p>
            <mat-checkbox
              color="primary"
              [formControlName]="box.formControlName"
              >{{ box.text }}</mat-checkbox
            >
          </p>
          <div
            class="filter-legend"
            [ngStyle]="{ 'background-color': box.color }"
            *ngIf="filters.get(box.formControlName).value"
          ></div>
        </div>
      </section>
    </mat-card>
  </mat-grid-tile>
  <mat-grid-tile
    colspan="3"
    rowspan="{{ bookList.length < 6 ? 6 : bookList.length + 1 }}"
  >
    <div class="book-list-container">
      <mat-card *ngFor="let entry of visibleBookList" class="book-list-entry">
        <img
          src="{{ entry.book.coverImage }}"
          alt=""
          class="book-list-entry-image"
        />

        <div class="book-list-entry-text">
          <mat-card-title class="book-list-entry-title">{{
            entry.book.title
          }}</mat-card-title>
          <mat-card-content>
            <h3>by {{ entry.book.author }}</h3>
            <div class="book-list-entry-blurb">
              <p>
                {{ removeHTMLTags(entry.book.blurb).substring(0, 300) + '...' }}
              </p>
            </div>
          </mat-card-content>
        </div>
        <div [ngClass]="[entry.status, 'book-list-entry-status-bar']"></div>
        <div class="book-list-entry-info">
          <mat-card
            [ngClass]="['rating-' + entry.rating, 'book-list-entry-rating']"
          >
            {{ entry.rating ? entry.rating : '-' }} / 10
          </mat-card>
          <mat-card [ngClass]="['book-list-entry-category']">{{
            entry.book.categories[0]
              ? entry.book.categories[0]
              : 'No genre information'
          }}</mat-card>
        </div>
        <button
          class="book-list-entry-update-button"
          mat-icon-button
          (click)="toggleUpdateEntryDialog(entry)"
        >
          <mat-icon>edit</mat-icon>
        </button>
        <button
          class="book-list-entry-delete-button"
          mat-icon-button
          (click)="deleteEntryVerification(entry.volumeId)"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </mat-card>
      <mat-card class="no-books" *ngIf="bookList.length == 0"
        >Nothing to display</mat-card
      >
    </div>
  </mat-grid-tile>
  <mat-grid-tile colspan="1" rowspan="3">
    <div class="add-a-book-container">
      <mat-card class="container">
        <mat-card-title class="add-a-book-header">Add a book</mat-card-title>
        <form [formGroup]="addBookFormGroup" (ngSubmit)="addBookToUserList()">
          <mat-form-field>
            <mat-chip-list #chipList>
              <mat-chip
                *ngFor="let title of titleSelected"
                [removable]="true"
                (removed)="titleSelected = []"
              >
                <span>{{ title }}</span>
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
              <input
                #autocompleteInput
                type="text"
                placeholder="Enter title"
                matInput
                formControlName="title"
                [matAutocomplete]="auto"
                [matChipInputFor]="chipList"
              />
              <mat-autocomplete #auto="matAutocomplete">
                <mat-option
                  *ngFor="let option of newBookOptions"
                  [value]="option.volumeInfo.title"
                  (onSelectionChange)="setBookToAdd(option)"
                >
                  {{ option.volumeInfo.title }} by
                  {{ option.volumeInfo.authors }}
                </mat-option>
              </mat-autocomplete>
            </mat-chip-list>
          </mat-form-field>
          <mat-card-content>
            <mat-form-field>
              <mat-label>Status</mat-label>
              <mat-select name="addBookStatus" formControlName="status">
                <mat-option value="Completed">Completed</mat-option>
                <mat-option value="Dropped">Dropped</mat-option>
                <mat-option value="On-hold">On-hold</mat-option>
                <mat-option value="Reading">Reading</mat-option>
                <mat-option value="Plan to read">Plan to read</mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field
              *ngIf="
                addBookFormGroup.get('status').value == 'Completed' ||
                addBookFormGroup.get('status').value == 'Dropped'
              "
            >
              <mat-label>Rating</mat-label>
              <mat-select name="addBookRating" formControlName="rating">
                <mat-option
                  *ngFor="let option of ratings"
                  [value]="option.value"
                  >{{ option.text }}</mat-option
                >
              </mat-select>
            </mat-form-field>
            <mat-form-field
              *ngIf="addBookFormGroup.get('status').value == 'Completed'"
            >
              <mat-label>Review</mat-label>
              <textarea
                matInput
                formControlName="review"
                name="addBookReview"
              ></textarea>
            </mat-form-field>
            <mat-form-field
              *ngIf="
                addBookFormGroup.get('status').value == 'Reading' ||
                addBookFormGroup.get('status').value == 'On-hold'
              "
            >
              <input
                matInput
                name="currentPageCount"
                placeholder="Current Page"
                formControlName="currentPageCount"
              />
            </mat-form-field>
            <mat-form-field
              style="width: 85%"
              appearance="fill"
              *ngIf="
                !(
                  addBookFormGroup.get('status').value == 'Plan to read' ||
                  addBookFormGroup.get('status').value == null
                )
              "
            >
              <mat-label>Start date</mat-label>
              <input
                matInput
                [matDatepicker]="picker"
                formControlName="startDate"
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="picker"
              ></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
            <mat-form-field
              style="width: 85%"
              appearance="fill"
              *ngIf="
                !(
                  addBookFormGroup.get('status').value == 'Plan to read' ||
                  addBookFormGroup.get('status').value == 'Reading' ||
                  addBookFormGroup.get('status').value == null
                )
              "
            >
              <mat-label>End date</mat-label>
              <input
                matInput
                [matDatepicker]="picker"
                formControlName="endDate"
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="picker"
              ></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
          </mat-card-content>
          <button
            mat-raised-button
            class="btn-block"
            style="position: absolute; bottom: 10%; width: 90%"
            (click)="addBookFormGroup.reset()"
          >
            Clear
          </button>
          <button
            mat-raised-button
            color="primary"
            class="btn-block"
            type="submit"
            style="position: absolute; bottom: 2%; width: 90%"
          >
            Add entry!
          </button>
        </form>
      </mat-card>
    </div>
  </mat-grid-tile>
  <mat-grid-tile colspan="1" rowspan="2">
    <mat-card class="container">
      <mat-card-title>Stats</mat-card-title>
      <mat-card-content>
        <h3>Completed: {{ stats.completed }}</h3>
        <h3>Dropped: {{ stats.dropped }}</h3>
        <h3>On-hold: {{ stats.onHold }}</h3>
        <h3>Reading: {{ stats.reading }}</h3>
        <h3>Plan to read: {{ stats.planToRead }}</h3>
        <h3>Pages read: {{ stats.pagesRead }}</h3>
        <h3>Average rating: {{ stats.averageRating }}</h3>
      </mat-card-content>
    </mat-card>
  </mat-grid-tile>
</mat-grid-list>
